<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quay Số Rút Thăm Trúng Thưởng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, #1a237e, #311b92);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 5px solid #ff9800;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .app-content {
            display: flex;
            flex-wrap: wrap;
            padding: 30px;
            gap: 30px;
        }
        
        .upload-section {
            flex: 1;
            min-width: 300px;
            background: #f5f5f5;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .lottery-section {
            flex: 2;
            min-width: 300px;
            background: #f5f5f5;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .section-title {
            color: #1a237e;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #ff9800;
            font-size: 1.8rem;
        }
        
        .file-upload-area {
            border: 3px dashed #1a237e;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 25px;
            background-color: #fff;
        }
        
        .file-upload-area:hover {
            background-color: #e8f0fe;
            border-color: #ff9800;
        }
        
        .file-upload-area i {
            font-size: 4rem;
            color: #1a237e;
            margin-bottom: 15px;
        }
        
        .file-upload-area h3 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .file-upload-area p {
            color: #666;
        }
        
        #fileInput {
            display: none;
        }
        
        .participants-list {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: white;
        }
        
        .participant-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        
        .participant-item:last-child {
            border-bottom: none;
        }
        
        .participant-item:hover {
            background-color: #f0f0f0;
        }
        
        .participant-number {
            font-weight: bold;
            color: #1a237e;
        }
        
        .participant-name {
            flex-grow: 1;
            text-align: left;
            padding-left: 15px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 25px;
        }
        
        button {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .primary-btn {
            background: linear-gradient(to right, #1a237e, #311b92);
            color: white;
            flex: 2;
        }
        
        .primary-btn:hover {
            background: linear-gradient(to right, #283593, #4527a0);
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(0, 0, 0, 0.2);
        }
        
        .secondary-btn {
            background: linear-gradient(to right, #ff9800, #ff5722);
            color: white;
            flex: 1;
        }
        
        .secondary-btn:hover {
            background: linear-gradient(to right, #ffb74d, #ff7043);
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(0, 0, 0, 0.2);
        }
        
        .reset-btn {
            background: linear-gradient(to right, #616161, #9e9e9e);
            color: white;
            flex: 1;
        }
        
        .reset-btn:hover {
            background: linear-gradient(to right, #757575, #bdbdbd);
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(0, 0, 0, 0.2);
        }
        
        .winner-display {
            background: linear-gradient(135deg, #1a237e, #ff9800);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            color: white;
            margin-bottom: 30px;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .winner-label {
            font-size: 1.8rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .winner-name {
            font-size: 3.5rem;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
            margin: 15px 0;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .winner-number {
            font-size: 1.5rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            margin-top: 10px;
        }
        
        .spinning .winner-name {
            animation: pulse 0.5s infinite alternate;
        }
        
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }
        
        .winners-list {
            margin-top: 25px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: white;
        }
        
        .winner-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            background: linear-gradient(to right, #f5f5f5, #fff);
        }
        
        .winner-item:last-child {
            border-bottom: none;
        }
        
        .winner-item:nth-child(1) {
            background: linear-gradient(to right, #fff9c4, #fff);
            font-weight: bold;
        }
        
        .winner-item:nth-child(2) {
            background: linear-gradient(to right, #e0e0e0, #fff);
        }
        
        .winner-item:nth-child(3) {
            background: linear-gradient(to right, #ffcc80, #fff);
        }
        
        .winner-rank {
            font-weight: bold;
            color: #1a237e;
            min-width: 30px;
        }
        
        .counter {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            font-size: 1.2rem;
        }
        
        .counter div {
            background: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .counter span {
            font-weight: bold;
            color: #1a237e;
            font-size: 1.5rem;
        }
        
        .instructions {
            background-color: #e8f5e9;
            border-left: 5px solid #4caf50;
            padding: 20px;
            margin-top: 30px;
            border-radius: 8px;
        }
        
        .instructions h3 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .instructions ol {
            padding-left: 20px;
            color: #555;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: white;
            margin-top: 30px;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .app-content {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .winner-name {
                font-size: 2.5rem;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-gift"></i> QUAY SỐ RÚT THĂM TRÚNG THƯỞNG</h1>
            <p class="subtitle">Ứng dụng quay số ngẫu nhiên cho 200 người tham gia</p>
        </header>
        
        <div class="app-content">
            <div class="upload-section">
                <h2 class="section-title"><i class="fas fa-upload"></i> Tải lên danh sách</h2>
                
                <div class="file-upload-area" id="dropArea">
                    <i class="fas fa-file-upload"></i>
                    <h3>Tải lên tệp danh sách người tham gia</h3>
                    <p>Nhấp để chọn tệp hoặc kéo thả tệp vào đây</p>
                    <p><small>Hỗ trợ định dạng .txt, .csv (mỗi dòng một tên)</small></p>
                    <input type="file" id="fileInput" accept=".txt,.csv">
                </div>
                
                <div class="counter">
                    <div>Tổng số: <span id="totalCount">0</span> người</div>
                    <div>Còn lại: <span id="remainingCount">0</span> người</div>
                </div>
                
                <div class="participants-list" id="participantsList">
                    <div class="participant-item">
                        <div class="participant-number">#1</div>
                        <div class="participant-name">Danh sách sẽ hiển thị tại đây</div>
                    </div>
                </div>
                
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> Hướng dẫn sử dụng</h3>
                    <ol>
                        <li>Tạo file văn bản (.txt hoặc .csv) chứa danh sách người tham gia (mỗi dòng một tên)</li>
                        <li>Tải file lên bằng cách nhấp vào vùng bên trên hoặc kéo thả file</li>
                        <li>Nhấn "Bắt đầu quay số" để chọn người trúng thưởng ngẫu nhiên</li>
                        <li>Nhấn "Làm mới" để bắt đầu lại hoặc "Xuất danh sách" để lưu kết quả</li>
                    </ol>
                </div>
            </div>
            
            <div class="lottery-section">
                <h2 class="section-title"><i class="fas fa-random"></i> Quay số trúng thưởng</h2>
                
                <div class="winner-display" id="winnerDisplay">
                    <div class="winner-label">NGƯỜI TRÚNG THƯỞNG</div>
                    <div class="winner-name" id="winnerName">Chuẩn bị quay số...</div>
                    <div class="winner-number" id="winnerNumber">Số thứ tự: --</div>
                </div>
                
                <div class="controls">
                    <button class="primary-btn" id="startBtn">
                        <i class="fas fa-play-circle"></i> Bắt đầu quay số
                    </button>
                    <button class="secondary-btn" id="exportBtn">
                        <i class="fas fa-file-export"></i> Xuất danh sách
                    </button>
                    <button class="reset-btn" id="resetBtn">
                        <i class="fas fa-redo"></i> Làm mới
                    </button>
                </div>
                
                <h3 style="margin-top: 30px; color: #1a237e;">
                    <i class="fas fa-trophy"></i> Danh sách người trúng thưởng
                </h3>
                
                <div class="winners-list" id="winnersList">
                    <div class="winner-item">
                        <div class="winner-rank">#1</div>
                        <div class="participant-name">Chưa có người trúng thưởng</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Ứng dụng Quay Số Rút Thăm Trúng Thưởng &copy; 2023 - Hỗ trợ tối đa 200 người tham gia</p>
    </footer>

    <script>
        // Biến toàn cục
        let participants = [];
        let winners = [];
        let isSpinning = false;
        let spinInterval;
        
        // DOM Elements
        const fileInput = document.getElementById('fileInput');
        const dropArea = document.getElementById('dropArea');
        const participantsList = document.getElementById('participantsList');
        const winnersList = document.getElementById('winnersList');
        const winnerName = document.getElementById('winnerName');
        const winnerNumber = document.getElementById('winnerNumber');
        const winnerDisplay = document.getElementById('winnerDisplay');
        const startBtn = document.getElementById('startBtn');
        const exportBtn = document.getElementById('exportBtn');
        const resetBtn = document.getElementById('resetBtn');
        const totalCount = document.getElementById('totalCount');
        const remainingCount = document.getElementById('remainingCount');
        
        // Xử lý sự kiện cho vùng kéo thả
        dropArea.addEventListener('click', () => fileInput.click());
        
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.style.backgroundColor = '#e1f5fe';
        });
        
        dropArea.addEventListener('dragleave', () => {
            dropArea.style.backgroundColor = '#fff';
        });
        
        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.style.backgroundColor = '#fff';
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFileUpload(e.dataTransfer.files[0]);
            }
        });
        
        // Xử lý khi chọn file
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleFileUpload(e.target.files[0]);
            }
        });
        
        // Xử lý file được tải lên
        function handleFileUpload(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const content = e.target.result;
                processFileContent(content);
            };
            
            reader.readAsText(file);
            
            // Hiển thị tên file
            dropArea.innerHTML = `
                <i class="fas fa-file-check" style="color:#4CAF50"></i>
                <h3>Đã tải lên: ${file.name}</h3>
                <p>Nhấp để chọn file khác</p>
                <p><small>${file.size} bytes</small></p>
            `;
        }
        
        // Xử lý nội dung file
        function processFileContent(content) {
            // Tách nội dung theo dòng và làm sạch
            let lines = content.split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);
            
            // Giới hạn tối đa 200 người
            if (lines.length > 200) {
                alert(`Danh sách có ${lines.length} người, chỉ lấy 200 người đầu tiên.`);
                lines = lines.slice(0, 200);
            }
            
            // Tạo danh sách người tham gia
            participants = lines.map((name, index) => ({
                id: index + 1,
                name: name,
                winner: false
            }));
            
            // Cập nhật giao diện
            updateParticipantsList();
            updateCounters();
            
            // Reset danh sách người thắng
            winners = [];
            updateWinnersList();
            
            // Hiển thị thông báo
            winnerName.textContent = "Sẵn sàng quay số!";
            winnerNumber.textContent = `Tổng số: ${participants.length} người tham gia`;
        }
        
        // Cập nhật danh sách người tham gia
        function updateParticipantsList() {
            participantsList.innerHTML = '';
            
            if (participants.length === 0) {
                participantsList.innerHTML = `
                    <div class="participant-item">
                        <div class="participant-number">--</div>
                        <div class="participant-name">Chưa có dữ liệu. Vui lòng tải lên danh sách.</div>
                    </div>
                `;
                return;
            }
            
            // Hiển thị tối đa 20 người đầu tiên
            const displayCount = Math.min(participants.length, 20);
            
            for (let i = 0; i < displayCount; i++) {
                const participant = participants[i];
                const participantElement = document.createElement('div');
                participantElement.className = 'participant-item';
                participantElement.innerHTML = `
                    <div class="participant-number">#${participant.id}</div>
                    <div class="participant-name">${participant.name}</div>
                    ${participant.winner ? '<i class="fas fa-trophy" style="color:#FF9800"></i>' : ''}
                `;
                participantsList.appendChild(participantElement);
            }
            
            if (participants.length > 20) {
                const moreElement = document.createElement('div');
                moreElement.className = 'participant-item';
                moreElement.style.fontStyle = 'italic';
                moreElement.textContent = `... và ${participants.length - 20} người khác`;
                participantsList.appendChild(moreElement);
            }
        }
        
        // Cập nhật danh sách người thắng
        function updateWinnersList() {
            winnersList.innerHTML = '';
            
            if (winners.length === 0) {
                winnersList.innerHTML = `
                    <div class="winner-item">
                        <div class="winner-rank">#1</div>
                        <div class="participant-name">Chưa có người trúng thưởng</div>
                    </div>
                `;
                return;
            }
            
            // Hiển thị tất cả người thắng (mới nhất lên đầu)
            const reversedWinners = [...winners].reverse();
            
            reversedWinners.forEach((winner, index) => {
                const winnerElement = document.createElement('div');
                winnerElement.className = 'winner-item';
                winnerElement.innerHTML = `
                    <div class="winner-rank">#${winners.length - index}</div>
                    <div class="participant-name">${winner.name}</div>
                    <div>Số: ${winner.id}</div>
                `;
                winnersList.appendChild(winnerElement);
            });
        }
        
        // Cập nhật bộ đếm
        function updateCounters() {
            totalCount.textContent = participants.length;
            const remaining = participants.filter(p => !p.winner).length;
            remainingCount.textContent = remaining;
        }
        
        // Quay số chọn người thắng
        function spinLottery() {
            if (isSpinning) return;
            
            // Kiểm tra còn người tham gia không
            const remainingParticipants = participants.filter(p => !p.winner);
            if (remainingParticipants.length === 0) {
                alert('Tất cả người tham gia đã trúng thưởng!');
                return;
            }
            
            // Bắt đầu hiệu ứng quay
            isSpinning = true;
            startBtn.innerHTML = '<i class="fas fa-stop-circle"></i> Đang quay số...';
            startBtn.classList.add('secondary-btn');
            startBtn.classList.remove('primary-btn');
            winnerDisplay.classList.add('spinning');
            
            let spinCount = 0;
            const maxSpins = 40; // Số lần thay đổi trước khi dừng
            const spinSpeed = 50; // Tốc độ quay (ms)
            
            spinInterval = setInterval(() => {
                // Chọn ngẫu nhiên một người từ những người chưa thắng
                const remaining = participants.filter(p => !p.winner);
                const randomIndex = Math.floor(Math.random() * remaining.length);
                const currentPick = remaining[randomIndex];
                
                // Hiển thị tên
                winnerName.textContent = currentPick.name;
                winnerNumber.textContent = `Số thứ tự: ${currentPick.id}`;
                
                spinCount++;
                
                // Dừng quay sau số lần nhất định
                if (spinCount >= maxSpins) {
                    clearInterval(spinInterval);
                    
                    // Đánh dấu người thắng
                    currentPick.winner = true;
                    winners.push(currentPick);
                    
                    // Cập nhật giao diện
                    updateParticipantsList();
                    updateWinnersList();
                    updateCounters();
                    
                    // Hiệu ứng thông báo
                    setTimeout(() => {
                        winnerDisplay.classList.remove('spinning');
                        winnerDisplay.style.background = 'linear-gradient(135deg, #4CAF50, #8BC34A)';
                        
                        setTimeout(() => {
                            winnerDisplay.style.background = 'linear-gradient(135deg, #1a237e, #ff9800)';
                        }, 2000);
                    }, 500);
                    
                    // Reset nút
                    isSpinning = false;
                    startBtn.innerHTML = '<i class="fas fa-play-circle"></i> Bắt đầu quay số';
                    startBtn.classList.remove('secondary-btn');
                    startBtn.classList.add('primary-btn');
                    
                    // Phát âm thanh (giả lập)
                    playWinnerSound();
                }
            }, spinSpeed);
        }
        
        // Phát âm thanh thông báo (giả lập)
        function playWinnerSound() {
            // Tạo âm thanh đơn giản bằng Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 523.25; // Nốt C5
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 1);
            } catch (e) {
                console.log("Không thể phát âm thanh: ", e);
            }
        }
        
        // Xuất danh sách người thắng
        function exportWinners() {
            if (winners.length === 0) {
                alert('Chưa có người trúng thưởng nào!');
                return;
            }
            
            let content = "DANH SÁCH NGƯỜI TRÚNG THƯỞNG\n";
            content += "===============================\n\n";
            
            winners.forEach((winner, index) => {
                content += `${index + 1}. ${winner.name} (Số: ${winner.id})\n`;
            });
            
            content += `\nTổng số: ${winners.length} người\n`;
            content += `Ngày xuất: ${new Date().toLocaleDateString('vi-VN')}`;
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'danh-sach-trung-thuong.txt';
            a.click();
            
            URL.revokeObjectURL(url);
        }
        
        // Reset ứng dụng
        function resetApp() {
            if (isSpinning) {
                clearInterval(spinInterval);
                isSpinning = false;
            }
            
            if (participants.length > 0) {
                // Reset trạng thái người tham gia
                participants.forEach(p => p.winner = false);
                updateParticipantsList();
            }
            
            winners = [];
            updateWinnersList();
            updateCounters();
            
            winnerName.textContent = "Đã làm mới! Sẵn sàng quay số";
            winnerNumber.textContent = "Số thứ tự: --";
            
            startBtn.innerHTML = '<i class="fas fa-play-circle"></i> Bắt đầu quay số';
            startBtn.classList.remove('secondary-btn');
            startBtn.classList.add('primary-btn');
            winnerDisplay.classList.remove('spinning');
        }
        
        // Thêm dữ liệu mẫu nếu không có file upload
        function loadSampleData() {
            const sampleNames = [
                "Nguyễn Văn An", "Trần Thị Bình", "Lê Văn Cường", "Phạm Thị Dung", "Hoàng Văn Đức",
                "Vũ Thị Hà", "Đặng Văn Hùng", "Bùi Thị Lan", "Đỗ Văn Minh", "Ngô Thị Nga",
                "Hồ Văn Phong", "Nguyễn Thị Quỳnh", "Trần Văn Sơn", "Lê Thị Tuyết", "Phạm Văn Tuấn",
                "Hoàng Thị Uyên", "Vũ Văn Việt", "Đặng Thị Xuân", "Bùi Văn Yến", "Đỗ Thị Ánh",
                "Ngô Văn Bảo", "Hồ Thị Châu", "Nguyễn Văn Dũng", "Trần Thị Giang", "Lê Văn Hiếu",
                "Phạm Thị Hương", "Hoàng Văn Khánh", "Vũ Thị Lệ", "Đặng Văn Nam", "Bùi Thị Oanh"
            ];
            
            // Giới hạn 200 người (lặp lại mẫu)
            participants = [];
            for (let i = 0; i < 200; i++) {
                const nameIndex = i % sampleNames.length;
                participants.push({
                    id: i + 1,
                    name: `${sampleNames[nameIndex]} ${i < sampleNames.length ? '' : `(${Math.floor(i/sampleNames.length) + 1})`}`.trim(),
                    winner: false
                });
            }
            
            updateParticipantsList();
            updateCounters();
        }
        
        // Gán sự kiện cho các nút
        startBtn.addEventListener('click', spinLottery);
        exportBtn.addEventListener('click', exportWinners);
        resetBtn.addEventListener('click', resetApp);
        
        // Tải dữ liệu mẫu khi khởi động
        window.addEventListener('DOMContentLoaded', loadSampleData);
    </script>
</body>
</html>
